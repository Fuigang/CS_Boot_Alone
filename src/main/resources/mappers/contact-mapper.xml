<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!-- 연락처 -->
 <!-- 오류 방지 예시용 고쳐쓰시오. -->
 <mapper namespace="Contact">
 
	<!--  연락처 목록 조회  -->
	<select id="getMyContacts" resultType="com.kedu.project.contact.ContactDTO"> 
		SELECT 
	        CONTACT_SEQ, 
	        OWNER_EMAIL, 
	        "NAME",          EMAIL, 
	        PHONE, 
	        CONTACT_GROUP, 
	        COMPANY_CODE, 
	        MEMO, 
	        IS_SHARE AS "share" FROM contact
	    ORDER BY CONTACT_SEQ DESC
	</select>

	<!-- 연락처 등록 -->
	<insert id="insertContact" parameterType="com.kedu.project.contact.ContactDTO">
		<selectKey keyProperty="contact_seq" resultType="int" order="BEFORE">
			SELECT contact_seq_seq.NEXTVAL FROM DUAL
		</selectKey>
	
		INSERT INTO contact (
		  CONTACT_SEQ, "OWNER_EMAIL", "NAME", "EMAIL", "PHONE", "CONTACT_GROUP", 
		  "COMPANY_CODE", "MEMO", "IS_SHARE"
		)
		SELECT
		  #{contact_seq}, #{owner_email, jdbcType=VARCHAR}, #{name}, #{email}, #{phone},
		  #{contact_group, jdbcType=VARCHAR}, m.COMPANY_CODE,
		  #{memo, jdbcType=VARCHAR}, #{share, jdbcType=VARCHAR}
		FROM member m
		WHERE m.email = #{owner_email}
	</insert>
	
	<!-- 개인 혹은 팀의 분류 버튼을 눌러 바꿀 시 -->
	<update id="updateContactGroup" parameterType="map">
	  UPDATE contact
	  SET contact_group = 
	    CASE 
	      WHEN #{share} = 'y' THEN '팀'
	      WHEN #{share} = 'n' THEN '개인'
	      ELSE contact_group
	    END
	  WHERE contact_seq = #{contact_seq}
	</update>
	
	<!-- 업로드 -->
	<update id="updateContact" parameterType="com.kedu.project.contact.ContactDTO"> 
		UPDATE contact 
	    SET 
	        "NAME" = #{name}, 
	        EMAIL = #{email}, 
	        PHONE = #{phone}, 
	        CONTACT_GROUP = #{contact_group, jdbcType=VARCHAR}, 
	        COMPANY_CODE = #{company_code, jdbcType=VARCHAR}, 
	        MEMO = #{memo, jdbcType=VARCHAR}, 
	        IS_SHARE = #{share, jdbcType=VARCHAR} 
	    WHERE CONTACT_SEQ = #{contact_seq}
	</update>
	
	<!-- 삭제 -->
	<delete id="deleteContact" parameterType="int">
	    DELETE FROM contact WHERE contact_seq = #{contact_seq}
	</delete>
  
  </mapper>